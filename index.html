<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    /* VARI√ÅVEIS DE CORES UNIMED (PALETA VERDE) */
    :root {
      --unimed-verde-principal: #00994D; /* Verde principal da Unimed */
      --unimed-verde-escuro: #007A3E; /* Um verde mais escuro para destaque */
      --unimed-verde-claro: #E8F5E9; /* Fundo suave para os blocos */
      --unimed-bg-gradiente: linear-gradient(135deg, #a8e89f 0%, #4caf50 100%); /* Gradiente de fundo */
      --text-color: #333;
      --border-color-light: #C8E6C9; /* Borda mais clara para contraste */
    }
    
    body {
      font-family: 'Roboto', Arial, sans-serif;
      background: var(--unimed-bg-gradiente); 
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 40px 20px;
    }
    .container {
      max-width: 600px;
      width: 100%;
      background-color: #fff;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); 
      transition: all 0.3s ease-in-out;
    }
    .unimed-header {
      text-align: center;
      margin-bottom: 30px;
    }
    .unimed-logo-container {
        margin-bottom: 15px;
        text-align: center;
    }
    .unimed-logo-container img {
        max-width: 180px; 
        height: auto;
        display: block;
        margin: 0 auto;
        border-radius: 5px;
    }
    .unimed-header h1 {
      font-size: 26px;
      color: var(--unimed-verde-principal);
      font-weight: 700;
      margin: 10px 0 5px 0;
    }
    .unimed-header h2 {
      font-size: 16px;
      color: var(--unimed-verde-escuro);
      font-weight: 400;
      margin-top: 0;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }

    .form-group {
      margin-bottom: 25px;
      padding: 20px;
      border: 1px solid var(--border-color-light);
      border-radius: 12px;
      background-color: var(--unimed-verde-claro); 
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
    }
    .form-group.identification {
      background-color: #fff;
      border: 2px solid var(--unimed-verde-principal);
      text-align: center;
    }
    
    label {
      display: block;
      font-weight: 700;
      margin-bottom: 15px;
      color: var(--unimed-verde-escuro);
      font-size: 18px;
    }
    input[type="text"] {
      padding: 15px;
      border: 2px solid var(--border-color-light);
      border-radius: 8px;
      font-size: 18px;
      text-align: center;
      width: 100%;
      box-sizing: border-box;
    }
    input[type="text"]:focus {
        border-color: var(--unimed-verde-principal);
    }
    textarea {
        width: 100%;
        padding: 15px;
        border: 2px solid var(--border-color-light);
        border-radius: 8px;
        font-size: 16px;
        box-sizing: border-box;
        margin-top: 5px;
    }
    textarea:focus {
        border-color: var(--unimed-verde-principal);
        outline: none;
    }
    
    .btn-action {
      background-color: var(--unimed-verde-principal);
      color: white;
      padding: 14px 25px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      font-weight: 700;
      width: 100%;
      margin-top: 15px;
      transition: background-color 0.3s, transform 0.1s;
    }
    .btn-action:hover {
      background-color: var(--unimed-verde-escuro);
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }
    .btn-action:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    
    /* Novo estilo para bot√£o secund√°rio (An√¥nimo) */
    .btn-secondary {
        background-color: transparent;
        color: var(--unimed-verde-escuro);
        border: 2px solid var(--unimed-verde-escuro);
        padding: 10px 20px;
        font-size: 16px;
        font-weight: 500;
        margin-top: 10px;
    }
    .btn-secondary:hover {
        background-color: var(--unimed-verde-claro);
        transform: none;
        box-shadow: none;
    }

    .message {
      text-align: center;
      padding: 20px;
      margin-top: 25px;
      border-radius: 6px;
      display: none;
      font-weight: 700;
      font-size: 18px;
    }
    .message.error {
      background: none;
      color: #cc0000;
      font-weight: 700;
      text-align: center;
      padding: 5px;
      margin-top: 10px;
      font-size: 1em;
      display: none;
    }
    .message.success {
      background-color: var(--unimed-verde-claro); 
      color: var(--unimed-verde-principal);
      border: 2px solid var(--unimed-verde-principal);
      font-size: 1.2em;
    }
    .loading {
        display: none;
        text-align: center;
        color: var(--unimed-verde-principal);
        margin-top: 10px;
    }
    #nomeMedicoDisplay {
      font-weight: 700;
      color: var(--unimed-verde-principal);
      margin-top: 15px;
      font-size: 1.1em;
      display: none;
      padding: 5px 0;
    }
    .hidden-content {
      display: none;
    }
    
    .radio-group {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 5px; 
    }
    .radio-option {
      flex: 1;
      min-width: 15%; 
      text-align: center;
    }
    .radio-option label {
      font-size: 14px;
      padding: 10px 5px;
      border: 1px solid var(--unimed-verde-principal);
      border-radius: 6px;
      color: var(--unimed-verde-principal);
      background-color: #fff;
      font-weight: 400;
      margin: 0;
      transition: all 0.2s ease;
    }
    .radio-option input[type="radio"]:checked + label {
      background-color: var(--unimed-verde-principal);
      color: #fff;
      border-color: var(--unimed-verde-principal);
      font-weight: 700;
    }
    .radio-option label:hover:not(:checked) {
        background-color: var(--unimed-verde-claro);
        color: var(--unimed-verde-escuro);
    }

    /* Responsividade */
    @media (max-width: 600px) {
        .container {
            padding: 20px;
            border-radius: 15px;
        }
        .radio-group {
            flex-direction: column;
            gap: 5px;
        }
        .radio-option {
            min-width: 100%;
        }
    }
  </style>
</head>
<body>

<div class="container">
  <div class="unimed-header">
    <div class="unimed-logo-container">
      <img src="https://www.unimed.coop.br/site/image/layout_set_logo?img_id=23193551&t=1759762919807" alt="Logo Unimed Araguaia">
    </div>
    <h1>Pesquisa de Satisfa√ß√£o ü•≥</h1>
    <h2>Evento: Dia dos M√©dicos | Sua Opini√£o √© Vital!</h2>
  </div>

  <form id="pesquisaForm">
    
    <div class="form-group identification" id="identificacao-step">
      <label for="cpf">1. üìÑ Digite seu CPF (Opcional):</label>
      <input type="text" id="cpf" placeholder="000.000.000-00" required>
      <div class="message error" id="erro-cpf"></div>
      <div class="loading" id="loading-cpf">Buscando...</div>
      <p id="nomeMedicoDisplay"></p>
      <button type="button" class="btn-action" id="btn-buscar">Confirmar CPF e Prosseguir</button>
      
      <button type="button" class="btn-action btn-secondary" id="btn-anonimo">Continuar sem CPF (An√¥nimo)</button>
    </div>
    
    <div id="pesquisa-step" class="hidden-content">
      <input type="hidden" id="nome-medico" name="nome-medico">
      <input type="hidden" id="cpf-medico" name="cpf-medico">

      <h3>Avalie o Evento</h3>

      <div class="form-group">
        <label>2. Como voc√™ avalia a organiza√ß√£o geral do evento?</label>
        <div class="radio-group">
          <div class="radio-option">
            <input type="radio" id="p1-pessimo" name="pergunta1" value="P√©ssimo" required>
            <label for="p1-pessimo">P√©ssimo</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p1-ruim" name="pergunta1" value="Ruim">
            <label for="p1-ruim">Ruim</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p1-regular" name="pergunta1" value="Regular">
            <label for="p1-regular">Regular</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p1-bom" name="pergunta1" value="Bom">
            <label for="p1-bom">Bom</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p1-excelente" name="pergunta1" value="Excelente">
            <label for="p1-excelente">Excelente</label>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>3. Como avalia a qualidade do local/estrutura do evento?</label>
        <div class="radio-group">
          <div class="radio-option">
            <input type="radio" id="p2-pessimo" name="pergunta2" value="P√©ssimo" required>
            <label for="p2-pessimo">P√©ssimo</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p2-ruim" name="pergunta2" value="Ruim">
            <label for="p2-ruim">Ruim</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p2-regular" name="pergunta2" value="Regular">
            <label for="p2-regular">Regular</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p2-bom" name="pergunta2" value="Bom">
            <label for="p2-bom">Bom</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p2-excelente" name="pergunta2" value="Excelente">
            <label for="p2-excelente">Excelente</label>
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label>4. Como voc√™ avalia a qualidade da comida servida?</label>
        <div class="radio-group">
          <div class="radio-option">
            <input type="radio" id="p3-pessimo" name="pergunta3" value="P√©ssimo" required>
            <label for="p3-pessimo">P√©ssimo</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p3-ruim" name="pergunta3" value="Ruim">
            <label for="p3-ruim">Ruim</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p3-regular" name="pergunta3" value="Regular">
            <label for="p3-regular">Regular</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p3-bom" name="pergunta3" value="Bom">
            <label for="p3-bom">Bom</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p3-excelente" name="pergunta3" value="Excelente">
            <label for="p3-excelente">Excelente</label>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>5. Como avalia as bebidas servidas?</label>
        <div class="radio-group">
          <div class="radio-option">
            <input type="radio" id="p4-pessimo" name="pergunta4" value="P√©ssimo" required>
            <label for="p4-pessimo">P√©ssimo</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p4-ruim" name="pergunta4" value="Ruim">
            <label for="p4-ruim">Ruim</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p4-regular" name="pergunta4" value="Regular">
            <label for="p4-regular">Regular</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p4-bom" name="pergunta4" value="Bom">
            <label for="p4-bom">Bom</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p4-excelente" name="pergunta4" value="Excelente">
            <label for="p4-excelente">Excelente</label>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>6. Como voc√™ avalia a m√∫sica/entretenimento?</label>
        <div class="radio-group">
          <div class="radio-option">
            <input type="radio" id="p5-pessimo" name="pergunta5" value="P√©ssimo" required>
            <label for="p5-pessimo">P√©ssimo</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p5-ruim" name="pergunta5" value="Ruim">
            <label for="p5-ruim">Ruim</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p5-regular" name="pergunta5" value="Regular">
            <label for="p5-regular">Regular</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p5-bom" name="pergunta5" value="Bom">
            <label for="p5-bom">Bom</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p5-excelente" name="pergunta5" value="Excelente">
            <label for="p5-excelente">Excelente</label>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>7. Como avalia o conte√∫do e a performance do palestrante?</label>
        <div class="radio-group">
          <div class="radio-option">
            <input type="radio" id="p6-pessimo" name="pergunta6" value="P√©ssimo" required>
            <label for="p6-pessimo">P√©ssimo</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p6-ruim" name="pergunta6" value="Ruim">
            <label for="p6-ruim">Ruim</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p6-regular" name="pergunta6" value="Regular">
            <label for="p6-regular">Regular</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p6-bom" name="pergunta6" value="Bom">
            <label for="p6-bom">Bom</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="p6-excelente" name="pergunta6" value="Excelente">
            <label for="p6-excelente">Excelente</label>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="melhoria">8. O que poderia ser melhorado para os pr√≥ximos eventos?</label>
        <textarea id="melhoria" name="pergunta7" rows="4" placeholder="Deixe suas sugest√µes... (Opcional)"></textarea>
      </div>

      <button type="submit" class="btn-action" id="btn-enviar">‚úÖ Enviar Pesquisa</button>
      <div class="loading" id="loading-envio">Enviando Respostas...</div>
    </div>
  </form>
  
  <div class="message success" id="sucesso-msg">
    **Obrigado!** Sua avalia√ß√£o foi enviada com sucesso. A Unimed Araguaia agradece seu feedback.
  </div>

</div>

<script>
  // Vari√°veis globais para rastrear se o modo an√¥nimo foi ativado
  let isAnonymous = false;

  // Fun√ß√£o de m√°scara de CPF
  function formatCPF(v) {
    v = v.replace(/\D/g, ""); 
    v = v.replace(/(\d{3})(\d)/, "$1.$2"); 
    v = v.replace(/(\d{3})(\d)/, "$1.$2"); 
    v = v.replace(/(\d{3})(\d{1,2})$/, "$1-$2"); 
    return v;
  }
  
  document.getElementById('cpf').addEventListener('input', function(e) {
    e.target.value = formatCPF(e.target.value);
  });

  // 1. L√≥gica do bot√£o AN√îNIMO
  document.getElementById('btn-anonimo').addEventListener('click', function() {
    isAnonymous = true;
    
    // Preenche os campos ocultos com valores de identifica√ß√£o an√¥nima
    document.getElementById('nome-medico').value = 'AN√îNIMO';
    document.getElementById('cpf-medico').value = '0'; 
    
    // Exibe a mensagem de prosseguimento
    const nomeDisplay = document.getElementById('nomeMedicoDisplay');
    nomeDisplay.innerHTML = `‚úÖ Prosseguindo de forma **An√¥nima**.`;
    nomeDisplay.style.display = 'block';
    
    // Esconde o bot√£o e campo de CPF, e mostra as perguntas
    document.getElementById('cpf').style.display = 'none';
    document.getElementById('btn-buscar').style.display = 'none';
    this.style.display = 'none'; // Esconde o bot√£o An√¥nimo
    
    document.getElementById('pesquisa-step').classList.remove('hidden-content');
    document.getElementById('identificacao-step').style.backgroundColor = 'var(--unimed-verde-claro)';
    document.getElementById('identificacao-step').style.borderColor = 'var(--unimed-verde-principal)';

    // Rolagem para o in√≠cio da pesquisa
    document.getElementById('pesquisa-step').scrollIntoView({ behavior: 'smooth' });
  });


  // 2. L√≥gica do bot√£o de BUSCAR CPF
  document.getElementById('btn-buscar').addEventListener('click', function() {
    isAnonymous = false;
    const cpfInput = document.getElementById('cpf');
    const cpf = cpfInput.value;
    const loading = document.getElementById('loading-cpf');
    const nomeDisplay = document.getElementById('nomeMedicoDisplay');
    const erroDisplay = document.getElementById('erro-cpf');
    const btnBuscar = this;

    // Limpa estados anteriores
    nomeDisplay.style.display = 'none';
    erroDisplay.style.display = 'none';
    document.getElementById('pesquisa-step').classList.add('hidden-content');
    
    // Valida√ß√£o b√°sica do formato
    if (cpf.length < 14) {
      erroDisplay.innerText = '‚ö†Ô∏è Por favor, digite um CPF v√°lido e completo.';
      erroDisplay.style.display = 'block';
      return;
    }
    
    btnBuscar.disabled = true;
    document.getElementById('btn-anonimo').disabled = true; // Desabilita o an√¥nimo durante a busca
    loading.style.display = 'block';

    // Chama a fun√ß√£o Apps Script para buscar o nome
    google.script.run
        .withSuccessHandler(function(response) {
            loading.style.display = 'none';
            btnBuscar.disabled = false;
            document.getElementById('btn-anonimo').disabled = false;
            
            if (response.status === 'sucesso') {
                const nome = response.nome;
                nomeDisplay.innerHTML = `‚úÖ Ol√°, **Dr(a). ${nome}**! Sua identifica√ß√£o foi confirmada.`;
                nomeDisplay.style.display = 'block';
                
                // Preenche os campos hidden e mostra a pesquisa
                document.getElementById('nome-medico').value = nome;
                document.getElementById('cpf-medico').value = cpf;
                document.getElementById('pesquisa-step').classList.remove('hidden-content');
                document.getElementById('identificacao-step').style.backgroundColor = 'var(--unimed-verde-claro)'; 
                document.getElementById('identificacao-step').style.borderColor = 'var(--unimed-verde-principal)';

                // Oculta o campo CPF e o bot√£o de buscar ap√≥s o sucesso
                document.getElementById('cpf').style.display = 'none';
                document.getElementById('btn-buscar').style.display = 'none';
                document.getElementById('btn-anonimo').style.display = 'none';


                // Rolagem para o in√≠cio da pesquisa
                document.getElementById('pesquisa-step').scrollIntoView({ behavior: 'smooth' });

            } else {
                erroDisplay.innerText = '‚ùå ' + response.mensagem;
                erroDisplay.style.display = 'block';
                document.getElementById('identificacao-step').style.backgroundColor = '#fff';
            }
        })
        .withFailureHandler(function(error) {
            loading.style.display = 'none';
            btnBuscar.disabled = false;
            document.getElementById('btn-anonimo').disabled = false;
            erroDisplay.innerText = '‚ùå Erro de comunica√ß√£o com o servidor. Tente novamente.';
            erroDisplay.style.display = 'block';
            console.error(error);
        })
        .buscarMedicoPorCPF(cpf);
  });

  // 3. L√≥gica de ENVIO DO FORMUL√ÅRIO (inalterada)
  document.getElementById('pesquisaForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const form = e.target;
    const dados = {};
    const btnEnviar = document.getElementById('btn-enviar');
    const loadingEnvio = document.getElementById('loading-envio');
    const sucessoMsg = document.getElementById('sucesso-msg');

    // Mapeamento dos dados do formul√°rio
    dados.cpf = form.elements['cpf-medico'].value;
    dados.nome = form.elements['nome-medico'].value;
    dados.pergunta1 = form.elements['pergunta1'].value;
    dados.pergunta2 = form.elements['pergunta2'].value;
    dados.pergunta3 = form.elements['pergunta3'].value;
    dados.pergunta4 = form.elements['pergunta4'].value;
    dados.pergunta5 = form.elements['pergunta5'].value;
    dados.pergunta6 = form.elements['pergunta6'].value;
    dados.pergunta7 = form.elements['pergunta7'].value;

    btnEnviar.disabled = true;
    loadingEnvio.style.display = 'block';

    // Chama a fun√ß√£o Apps Script para gravar as respostas
    google.script.run
        .withSuccessHandler(function(response) {
            loadingEnvio.style.display = 'none';
            
            if (response.status === 'sucesso') {
                document.getElementById('pesquisa-step').style.display = 'none';
                document.getElementById('identificacao-step').style.display = 'none';
                sucessoMsg.style.display = 'block';
                document.body.scrollIntoView({ behavior: 'smooth' });
            } else {
                alert('Ocorreu um erro ao enviar a pesquisa. Tente novamente. Detalhe: ' + response.mensagem);
                btnEnviar.disabled = false;
            }
        })
        .withFailureHandler(function(error) {
            loadingEnvio.style.display = 'none';
            btnEnviar.disabled = false;
            alert('Erro de comunica√ß√£o com o servidor. Tente novamente.');
            console.error(error);
        })
        .gravarRespostas(dados);
  });
</script>

</body>
</html>
